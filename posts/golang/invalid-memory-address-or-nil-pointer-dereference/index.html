<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WWDBK5SV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-N2WWDBK5SV')</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Invalid Memory Address or Nil Pointer Dereference &ndash; Runbooks</title><meta name=description property="og:description" content="panic: runtime error: invalid memory address or nil pointer dereference|"><meta name=apple-mobile-web-app-title content="Runbooks"><link rel=stylesheet href=/runbooks/assets/syntax.css><link rel=stylesheet href=/runbooks/assets/primer-build.css><link rel=stylesheet href=/runbooks/assets/style.css><link rel=stylesheet href=https://containersolutions.github.io/runbooks/custom_style.899dd13784115b34654e51c818307a0a.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://containersolutions.github.io/runbooks/>Runbooks</a><div class="pseudo-menu-item text-gray"><div class=pseudo-flex-item><span class=pseudo-nav-item><a href=https://github.com/containersolutions/runbooks/edit/master/content/posts/golang/invalid-memory-address-or-nil-pointer-dereference.md class=edit-link><svg aria-hidden="true" height="16" role="img" viewBox="0 0 14 16" width="14" class="pencil"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996.0 011.41.0l1.59 1.59c.39.39.39 1.02.0 1.41z"/></svg>&nbsp;
Improve this page</a></span></div></div><div class=UnderlineNav-body><div class="flex-column position-relative dropdown"><span class=UnderlineNav-item>Nav Menu</span><div class="Box Box--condensed position-absolute dropdown-content"><div class=Box-body><a href=/runbooks/>Home</a></div><div class=Box-body><a href=/runbooks/posts/kubernetes/>Kubernetes</a></div><div class=Box-body><a href=/runbooks/posts/linux/>Linux</a></div><div class=Box-body><a href=/runbooks/posts/networking/>Networking</a></div><div class=Box-body><a href=/runbooks/posts/python/>Python</a></div><div class=Box-body><a href=/runbooks/posts/how-to/>How-Tos</a></div><div class=Box-body><a href=/runbooks/posts/golang/>Go</a></div></div></div></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">Invalid Memory Address or Nil Pointer Dereference</div></div><div class=Subhead-description><div class=float-md-right><span title="Lastmod: 2023-01-26. Published at: 0001-01-01.">Lastmod: 2023-01-26</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><h2 id=overview>Overview</h2><p>Example error:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#a6e22e>panic</span>: <span style=color:#a6e22e>runtime</span> <span style=color:#66d9ef>error</span>: <span style=color:#a6e22e>invalid</span> <span style=color:#a6e22e>memory</span> <span style=color:#a6e22e>address</span> <span style=color:#a6e22e>or</span> <span style=color:#66d9ef>nil</span> <span style=color:#a6e22e>pointer</span> <span style=color:#a6e22e>dereference</span>
[<span style=color:#a6e22e>signal</span> <span style=color:#a6e22e>SIGSEGV</span>: <span style=color:#a6e22e>segmentation</span> <span style=color:#a6e22e>violation</span> <span style=color:#a6e22e>code</span>=<span style=color:#ae81ff>0x1</span> <span style=color:#a6e22e>addr</span>=<span style=color:#ae81ff>0x0</span> <span style=color:#a6e22e>pc</span>=<span style=color:#ae81ff>0x497783</span>]
</code></pre></div><p>This issue happens when you reference an unassigned (nil) pointer.</p><p>Go uses an asterisk <code>*</code> to specify a pointer to a variable, and an ampersand <code>&</code> to generate a pointer to a given variable. For example:</p><ul><li><code>var p *int</code> - p is a pointer to a type integer</li><li><code>p := &i</code> - p is a pointer to variable i</li></ul><h2 id=initial-steps-overview>Initial Steps Overview</h2><ol><li><p><a href=#step-1>Check if the pointer is being set</a></p></li><li><p><a href=#step-2>Check for a nil assignment to the pointer</a></p></li></ol><h2 id=detailed-steps>Detailed Steps</h2><h3 id=step-1>1) Check if the pointer is being set</h3><p>Before a pointer can be referenced, it needs to have something assigned to it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>person</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
	<span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>myPointer</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>person</span>
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>myPointer</span>.<span style=color:#a6e22e>Name</span>)
}
</code></pre></div><pre><code>$ go run main.go
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x497783]
</code></pre><p>The above code causes Go to panic because, while <code>myPointer</code> has been declared as a pointer to a <code>person</code> object, it currently does not point to a particular instance of such an object. This can be solved by assigning a variable to the pointer <a href=#solution-a>(Solution A)</a> or by creating and referencing a new object <a href=#solution-b>(Solution B)</a>.</p><h3 id=step-2>2) Check for a nil assignment to the pointer</h3><p>Another possibility is that the pointer is being set to <code>nil</code> somewhere in your code. This could be, for example, a function returning <code>nil</code> after failing to accomplish a task.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NumberObject</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>number</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createNumberObj</span>(<span style=color:#a6e22e>num</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>result</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>NumberObject</span>) {
	<span style=color:#75715e>// Returns a pointer to a NumberObject if the number is allowed, otherwise returns nil
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>num</span> &lt; <span style=color:#ae81ff>100</span> {
		<span style=color:#a6e22e>numberObj</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NumberObject</span>{<span style=color:#a6e22e>num</span>}
		<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>numberObj</span> <span style=color:#75715e>// Returns a reference to the new object
</span><span style=color:#75715e></span>	} <span style=color:#66d9ef>else</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>myNumberObject</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>createNumberObject</span>(<span style=color:#ae81ff>101</span>)
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>myNumberObject</span>.<span style=color:#a6e22e>number</span>) <span style=color:#75715e>// This will cause Go to panic!
</span><span style=color:#75715e></span>}
</code></pre></div><p>Here a <code>NumberObject</code> is created only if the input is less than 100. A pointer is returned by the function either way, but the <code>main()</code> function is not prepared to handle the <code>nil</code> pointer that is returned if the conditions aren&rsquo;t met, causing Go to panic. It would be best to handle this issue by either handling the nil pointer as demonstrated in <a href=#solution-b>Solution B</a>, or by creaing and referencing an empty object as per <a href=#solution-c>Solution C</a>.</p><h2 id=solutions-list>Solutions List</h2><p>A) <a href=#solution-a>Assign a variable to the pointer</a></p><p>B) <a href=#solution-b>Handle the nil pointer</a></p><p>C) <a href=#solution-c>Create and reference a new variable</a></p><h2 id=solutions-detail>Solutions Detail</h2><h3 id=solution-a>A) Assign a variable to the pointer</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>struct</span>{
	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
	<span style=color:#a6e22e>Age</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>()
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>myPointer</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Person</span> <span style=color:#75715e>// This is currently a nil pointer
</span><span style=color:#75715e></span>
	<span style=color:#a6e22e>aPerson</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Person</span>{
		<span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;Joey&#34;</span>,
		<span style=color:#a6e22e>Age</span>:  <span style=color:#ae81ff>29</span>,
	} <span style=color:#75715e>// This is a Person object
</span><span style=color:#75715e></span>
	<span style=color:#a6e22e>myPointer</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>aPerson</span> <span style=color:#75715e>// Now the pointer references the same Person as &#39;aPerson&#39;
</span><span style=color:#75715e></span>
	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>joey</span>.<span style=color:#a6e22e>Name</span>)
}
</code></pre></div><p>Here the variable <code>aPerson</code> is created, after which we can use the Go <code>&</code> syntax to get this variable&rsquo;s reference (location in memory) and assign it to <code>myPointer</code>. Importantly, both <code>myPointer</code> and <code>aPerson</code> now point to the same variable in memory, and modifications made to either will apply to both.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>()
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>myPointer</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>person</span>
	<span style=color:#a6e22e>myPointer</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>anotherPerson</span>

	<span style=color:#a6e22e>anotherPerson</span>.<span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;Pete&#34;</span>

	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>myPointer</span>.<span style=color:#a6e22e>Name</span>) <span style=color:#75715e>// This will print &#34;Pete&#34;!
</span><span style=color:#75715e></span>}
</code></pre></div><h3 id=solution-b>B) Handle the nil pointer</h3><p>Going back to the code used in <a href=#step-2>Step 2</a>, we can expand this to check for and &lsquo;handle&rsquo; a nil value before the code continues.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NumberObject</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>number</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createNumberObj</span>(<span style=color:#a6e22e>num</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>result</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>NumberObject</span>) {
	<span style=color:#75715e>// Returns a pointer to a NumberObject if the number is allowed, otherwise returns nil
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>num</span> &lt; <span style=color:#ae81ff>100</span> {
		<span style=color:#a6e22e>numberObj</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NumberObject</span>{<span style=color:#a6e22e>num</span>}
		<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>numberObj</span> <span style=color:#75715e>// Returns a reference to the new object
</span><span style=color:#75715e></span>	} <span style=color:#66d9ef>else</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>myNumberObject</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>createNumberObject</span>(<span style=color:#ae81ff>101</span>)

	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>myNumberObject</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Failed to create number object!&#34;</span>)
	}

	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>myNumberObject</span>.<span style=color:#a6e22e>number</span>) <span style=color:#75715e>// This line is not reached if num &gt;= 100!
</span><span style=color:#75715e></span>}
</code></pre></div><p>There are several ways this situation could be handled; in this particular instance the <code>log.Fatal</code> function will terminate the program if myNumberObject is a nil pointer. Another option would be to return an error in the <code>createNumberObj</code> function informing the user that the inputted number was too high. A further option, and one which would allow the program to continute executing, would be to create and reference a new variable, as seen in <a href=#solution-c>Solution C</a>.</p><h3 id=solution-c>C) Create and reference a new variable</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NumberObject</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>number</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>createNumberObj</span>(<span style=color:#a6e22e>num</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>result</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>NumberObject</span>) {
	<span style=color:#a6e22e>numberObj</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NumberObject</span>{} <span style=color:#75715e>// Creates a new, empty NumberObject
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>num</span> &lt; <span style=color:#ae81ff>100</span> {
		<span style=color:#a6e22e>numberObj</span>.<span style=color:#a6e22e>number</span> = <span style=color:#a6e22e>num</span>
	}
	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>numberObj</span> <span style=color:#75715e>// Returns a reference to the new object
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>myNumberObject</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>createNumberObject</span>(<span style=color:#ae81ff>101</span>)

	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>myNumberObject</span>.<span style=color:#a6e22e>number</span>) <span style=color:#75715e>// Will print 0 instead of causing a panic!
</span><span style=color:#75715e></span>}
</code></pre></div><p>Here we have restructured the program to first create a new variable, and then edit the properties of this object as the program executes, removing the risk of the function returning a nil pointer. In the event it is not explicitly set, the value of <code>NumberObject.number</code> will default to 0, rather than nil as you might expect - this is because Go has default &lsquo;zero values&rsquo; for all it&rsquo;s types, which you can read more about <a href=https://yourbasic.org/golang/default-zero-value/>here</a>.</p><h2 id=further-information>Further Information</h2><p><a href=https://yourbasic.org/golang/gotcha-nil-pointer-dereference/>Gotcha Nil Pointer Dereference</a></p><p><a href=https://yourbasic.org/golang/default-zero-value/>Golang default zero values</a></p><p><a href=https://tour.golang.org/moretypes/1>Go Pointers</a></p><h2 id=owner>Owner</h2><p><a href=https://github.com/jabray5>Joey</a></p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//runbooks.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>Invalid Memory Address or Nil Pointer Dereference</b><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#initial-steps-overview>Initial Steps Overview</a></li><li><a href=#detailed-steps>Detailed Steps</a><ul><li><a href=#step-1>1) Check if the pointer is being set</a></li><li><a href=#step-2>2) Check for a nil assignment to the pointer</a></li></ul></li><li><a href=#solutions-list>Solutions List</a></li><li><a href=#solutions-detail>Solutions Detail</a><ul><li><a href=#solution-a>A) Assign a variable to the pointer</a></li><li><a href=#solution-b>B) Handle the nil pointer</a></li><li><a href=#solution-c>C) Create and reference a new variable</a></li></ul></li><li><a href=#further-information>Further Information</a></li><li><a href=#owner>Owner</a></li></ul></nav></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><div class="container-lg bg-white h-50">&nbsp;</div><div class=footer-container-wrapper><div class=footer-image><a href=https://container-solutions.com><img src=https://containersolutions.github.io/runbooks/images/logo-main.svg class=hs-image-widget style=width:120px;border-width:0;border:0 width=120 alt=logo-main title=logo-main></a></div><div>Runbooks is sponsored by <a href=https://container-solutions.com>Container Solutions</a>. We bring culture, strategy, and technology together<br>&mdash;to make sure your Cloud Native migration is done right. <a href=https://www.container-solutions.com>See how we can help</a></div></div><div class="bg-white h-10"><div class="text-small text-gray credits">Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</div></div></body></html>