<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WWDBK5SV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-N2WWDBK5SV')</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pod Stuck In Terminating State &ndash; Runbooks</title><meta name=description property="og:description" content="Pod Stuck In Terminating State|"><meta name=apple-mobile-web-app-title content="Runbooks"><link rel=stylesheet href=/runbooks/assets/syntax.css><link rel=stylesheet href=/runbooks/assets/primer-build.css><link rel=stylesheet href=/runbooks/assets/style.css><link rel=stylesheet href=https://containersolutions.github.io/runbooks/custom_style.899dd13784115b34654e51c818307a0a.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://containersolutions.github.io/runbooks/>Runbooks</a><div class="pseudo-menu-item text-gray"><div class=pseudo-flex-item><span class=pseudo-nav-item><a href=https://github.com/containersolutions/runbooks/edit/master/content/posts/kubernetes/pod-stuck-in-terminating-state.md class=edit-link><svg aria-hidden="true" height="16" role="img" viewBox="0 0 14 16" width="14" class="pencil"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996.0 011.41.0l1.59 1.59c.39.39.39 1.02.0 1.41z"/></svg>&nbsp;
Improve this page</a></span></div></div><div class=UnderlineNav-body><div class="flex-column position-relative dropdown"><span class=UnderlineNav-item>Nav Menu</span><div class="Box Box--condensed position-absolute dropdown-content"><div class=Box-body><a href=/runbooks/>Home</a></div><div class=Box-body><a href=/runbooks/posts/kubernetes/>Kubernetes</a></div><div class=Box-body><a href=/runbooks/posts/linux/>Linux</a></div><div class=Box-body><a href=/runbooks/posts/networking/>Networking</a></div><div class=Box-body><a href=/runbooks/posts/python/>Python</a></div><div class=Box-body><a href=/runbooks/posts/how-to/>How-Tos</a></div><div class=Box-body><a href=/runbooks/posts/golang/>Go</a></div></div></div></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">Pod Stuck In Terminating State</div></div><div class=Subhead-description><div class=float-md-right><span title="Lastmod: 2023-01-26. Published at: 0001-01-01.">Lastmod: 2023-01-26</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><h2 id=overview>Overview</h2><p>A pod has been deleted, and remains in a status of Terminated for more than a few seconds.</p><p>This can happen because:</p><ul><li><p>the pod has a finalizer associated with it that is not completing, or</p></li><li><p>the pod is not responding to termination signals</p></li></ul><h2 id=check-runbook-match>Check RunBook Match</h2><p>This runbook matches if pods have been deleted and remain in a Terminated state for a long time, or a time longer than is expected.</p><p>When running a <code>kubectl get pods</code> command, you will see a line like this in the output for your pod:</p><pre><code>NAME                     READY     STATUS             RESTARTS   AGE
nginx-7ef9efa7cd-qasd2   1/1       Terminating        0          1h
</code></pre><h2 id=initial-steps-overview>Initial Steps Overview</h2><ol><li><p><a href=#detailed-step-1>Gather information</a></p></li><li><p><a href=#detailed-step-2>Check for finalizers</a></p></li><li><p><a href=#detailed-step-3>Check the status of the node</a></p></li><li><p><a href=#detailed-step-4>Force-delete the pod</a></p></li></ol><h2 id=detailed-steps>Detailed Steps</h2><h3 id=detailed-step-1>1) Gather information</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod -n <span style=color:#f92672>[</span>NAMESPACE<span style=color:#f92672>]</span> -p <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span> -o yaml
</code></pre></div><h3 id=detailed-step-2>2) Check for finalizers</h3><p>First we check to see whether the pod has any finalizers. If it does, their failure to complete may be the root cause.</p><p>Get the pod&rsquo;s configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod -n <span style=color:#f92672>[</span>NAMESPACE<span style=color:#f92672>]</span> -p <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span> -o yaml &gt; /tmp/runbooks_pod_configuration.txt
</code></pre></div><p>and look for a <code>finalizers</code> section under <code>metadata</code>. If any finalizers are present, then go to <a href=#solution-a>Solution A)</a>.</p><h3 id=detailed-step-3>3) Check the status of the node</h3><p>It is possible that the node your pod(s) is/are running on has failed in some way.</p><p>If you see from the <code>/tmp/runbooks_pod_configuration.txt</code> file that all pods on the same node are in a <code>Terminating</code> state on a specific node, then this may be the issue.</p><h3 id=detailed-step-4>4) Delete the pod</h3><p>The pod may not be terminating due to a process that is not responding to a signal. The exact reason will be context-specific and application dependent. Common causes include:</p><ul><li><p>A tight loop in userspace code that does not allow for interrupt signals</p></li><li><p>A maintenance process (eg garbage collection) on the application runtime</p></li></ul><p>In these cases, <a href=#solution-b>Solution B)</a> may resolve the issue.</p><h3 id=detailed-step-5>5) Restart kubelet</h3><p>If nothing else works, it may be worth trying to restart the kubelet on the node the pod was trying to run on. See the output of</p><p>See <a href=#solution-c>solution C)</a></p><h2 id=solutions-list>Solutions List</h2><p>A) <a href=#solution-a>Remove finalizers</a></p><p>B) <a href=#solution-b>Force-delete the pod</a></p><p>C) <a href=#solution-c>Restart kubelet</a></p><h2 id=solutions-detail>Solutions Detail</h2><h3 id=solution-a>A) Remove finalizers</h3><p>To remove any finalizers from the pod, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl patch pod <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span> -p <span style=color:#e6db74>&#39;{&#34;metadata&#34;:{&#34;finalizers&#34;:null}}&#39;</span>
</code></pre></div><h3 id=solution-b>B) Force-delete the pod</h3><p>Please note that this is more of a workaround than a solution, and should be done with care to ensure that it won&rsquo;t result in further problems. See also <a href=https://kubernetes.io/docs/tasks/run-application/force-delete-stateful-set-pod/>here</a> for information pertaining to StatefulSets.</p><p>To force-delete the pod, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl delete pod --grace-period<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> --force --namespace <span style=color:#f92672>[</span>NAMESPACE<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span>
</code></pre></div><p>If this [does not work]{#check-resolution}, then return to the previous step.</p><h3 id=solution-c>C) Restart kubelet</h3><p>If you can, SSH to the node and restart the kubelet process. If you do not have access or permission, this may require an administrator to get involved.</p><p>Before you do this (and if you have access), check the kubelet logs to see whether there are any issues in the kubelet logs.</p><h2 id=check-resolution>Check Resolution</h2><p>If the specific pod no longer shows up when running <code>kubectl get pods</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl get pod -n mynamespace -p nginx-7ef9efa7cd-qasd2
NAME                     READY     STATUS             RESTARTS   AGE
</code></pre></div><p>then the issue has been resolved.</p><h2 id=further-steps>Further Steps</h2><p>If the issue recurs (or not), you may want to:</p><ol><li><p>[Check whether the finalizer&rsquo;s work needs to still be done]{#further-steps-1}</p></li><li><p>[Determine the root cause]{#further-steps-2}</p></li></ol><h3 id=further-steps-1>1) Check whether the finalizer&rsquo;s work needs to still be done</h3><p>This will vary depending on what the finalizer did.</p><p>See <a href=#further-information>further information</a> for guidance on finalizers.</p><p>Common cases of finalizers not completing include:</p><ul><li>Volume</li></ul><h3 id=further-steps-2>2) Determine the root cause</h3><p>This will vary depending on what the finalizer did, and will require context-specific knowledge.</p><p>Some tips:</p><ul><li>If you have access, check the kubelet logs. Controllers can log useful information there.</li></ul><h2 id=further-information>Further Information</h2><p><a href=https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#finalizers>Finalizers</a></p><p><a href=https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/>Container Lifecycle Hooks</a></p><p><a href=https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods>Termination of Pods</a></p><p><a href=https://unofficial-kubernetes.readthedocs.io/en/latest/concepts/abstractions/pod-termination/>Unofficial Kubernetes Pod Termination</a></p><p><a href=https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/#looking-at-logs>Kubelet logs</a></p><h2 id=owner>Owner</h2><p><a href=https://github.com/ianmiell>Ian Miell</a></p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//runbooks.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>Pod Stuck In Terminating State</b><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#check-runbook-match>Check RunBook Match</a></li><li><a href=#initial-steps-overview>Initial Steps Overview</a></li><li><a href=#detailed-steps>Detailed Steps</a><ul><li><a href=#detailed-step-1>1) Gather information</a></li><li><a href=#detailed-step-2>2) Check for finalizers</a></li><li><a href=#detailed-step-3>3) Check the status of the node</a></li><li><a href=#detailed-step-4>4) Delete the pod</a></li><li><a href=#detailed-step-5>5) Restart kubelet</a></li></ul></li><li><a href=#solutions-list>Solutions List</a></li><li><a href=#solutions-detail>Solutions Detail</a><ul><li><a href=#solution-a>A) Remove finalizers</a></li><li><a href=#solution-b>B) Force-delete the pod</a></li><li><a href=#solution-c>C) Restart kubelet</a></li></ul></li><li><a href=#check-resolution>Check Resolution</a></li><li><a href=#further-steps>Further Steps</a><ul><li><a href=#further-steps-1>1) Check whether the finalizer&rsquo;s work needs to still be done</a></li><li><a href=#further-steps-2>2) Determine the root cause</a></li></ul></li><li><a href=#further-information>Further Information</a></li><li><a href=#owner>Owner</a></li></ul></nav></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><div class="container-lg bg-white h-50">&nbsp;</div><div class=footer-container-wrapper><div class=footer-image><a href=https://container-solutions.com><img src=https://containersolutions.github.io/runbooks/images/logo-main.svg class=hs-image-widget style=width:120px;border-width:0;border:0 width=120 alt=logo-main title=logo-main></a></div><div>Runbooks is sponsored by <a href=https://container-solutions.com>Container Solutions</a>. We bring culture, strategy, and technology together<br>&mdash;to make sure your Cloud Native migration is done right. <a href=https://www.container-solutions.com>See how we can help</a></div></div><div class="bg-white h-10"><div class="text-small text-gray credits">Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</div></div></body></html>