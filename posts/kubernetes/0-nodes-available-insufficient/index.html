<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WWDBK5SV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-N2WWDBK5SV')</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>0/1 nodes available: insufficient cpu, insufficient memory &ndash; Runbooks</title><meta name=description property="og:description" content="No nodes available errors|"><meta name=apple-mobile-web-app-title content="Runbooks"><link rel=stylesheet href=/runbooks/assets/syntax.css><link rel=stylesheet href=/runbooks/assets/primer-build.css><link rel=stylesheet href=/runbooks/assets/style.css><link rel=stylesheet href=https://containersolutions.github.io/runbooks/custom_style.899dd13784115b34654e51c818307a0a.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://containersolutions.github.io/runbooks/>Runbooks</a><div class="pseudo-menu-item text-gray"><div class=pseudo-flex-item><span class=pseudo-nav-item><a href=https://github.com/containersolutions/runbooks/edit/master/content/posts/kubernetes/0-nodes-available-insufficient.md class=edit-link><svg aria-hidden="true" height="16" role="img" viewBox="0 0 14 16" width="14" class="pencil"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996.0 011.41.0l1.59 1.59c.39.39.39 1.02.0 1.41z"/></svg>&nbsp;
Improve this page</a></span></div></div><div class=UnderlineNav-body><div class="flex-column position-relative dropdown"><span class=UnderlineNav-item>Nav Menu</span><div class="Box Box--condensed position-absolute dropdown-content"><div class=Box-body><a href=/runbooks/>Home</a></div><div class=Box-body><a href=/runbooks/posts/kubernetes/>Kubernetes</a></div><div class=Box-body><a href=/runbooks/posts/linux/>Linux</a></div><div class=Box-body><a href=/runbooks/posts/networking/>Networking</a></div><div class=Box-body><a href=/runbooks/posts/python/>Python</a></div><div class=Box-body><a href=/runbooks/posts/how-to/>How-Tos</a></div><div class=Box-body><a href=/runbooks/posts/golang/>Go</a></div></div></div></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">0/1 nodes available: insufficient cpu, insufficient memory</div></div><div class=Subhead-description><div class=float-md-right><span title="Lastmod: 2023-01-26. Published at: 0001-01-01.">Lastmod: 2023-01-26</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><h2 id=overview>Overview</h2><p>Example errors:</p><pre><code>0/1 nodes available: insufficient memory
0/1 nodes available: insufficient cpu
</code></pre><p>More generally:</p><pre><code>0/[n] nodes available: insufficient [resource]
</code></pre><p>This issue happens when Kubernetes does not have enough resources to fulfil your workload request.</p><h2 id=initial-steps-overview>Initial Steps Overview</h2><ol><li><p><a href=#step-1>Determine requested resources</a></p></li><li><p><a href=#step-2>Have you requested too many resources?</a></p></li></ol><h2 id=detailed-steps>Detailed Steps</h2><h3 id=step-1>1) Determine requested resources</h3><p>To determine your requested resources for your workload, you must first extract its YAML.</p><p>What type of resource to extract the YAML for may depend, but most commonly you can just get the YAML for the pod that reports the problem.</p><p>From that YAML, determine whether there are any resource requests made in the <code>containers</code> section, under <code>resources</code>.</p><p>A simplified YAML that makes a large request for memory resources (1000G) might look like this, for example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>too-much-mem</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>command</span>:
        - <span style=color:#ae81ff>sleep</span>
        - <span style=color:#e6db74>&#34;3600&#34;</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>broken-pods-too-much-mem-container</span>
      <span style=color:#f92672>resources</span>:
        <span style=color:#f92672>requests</span>:
          <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1000Gi&#34;</span>
</code></pre></div><p>If no resource requests are in the YAML, then a default request may be made. What this request is will depend on other configuration in the cluster. See <a href=https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/>here</a> for more information.</p><p>See <a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/>here</a> for more information.</p><p>If no request is made and you are out of resources, then it is likely that you have no available nodes. At this point you need to consider <a href=#solution-a>solution A</a>.</p><h3 id=step-2>2) Have you requested too many resources?</h3><p>If you <em>have</em> made a resource request, then there are two possibilities:</p><ul><li><p>Your resource request cannot fit into any node on the cluster</p></li><li><p>Your resource request can fit on a node in the cluster, but those nodes already have workloads running on them which block yours being provisioned</p></li></ul><p><a href=#step-1>Step 1</a> should have shown you whether you are specifically requesting resources. Once you know what those resources are, you can compare them to the resources available on each node.</p><p>If you are able, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl describe nodes
</code></pre></div><p>which, under &lsquo;Capacity:&rsquo;, &lsquo;Allocatable:&rsquo;, and &lsquo;Allocated resources:&rsquo; will tell you the resources available in each node, eg:</p><pre><code>$ kubectl describe nodes
[...]
Capacity:
  cpu:                4
  ephemeral-storage:  61255492Ki
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             2038904Ki
  pods:               110
Allocatable:
  cpu:                4
  ephemeral-storage:  56453061334
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             1936504Ki
  pods:               110
[...]
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests    Limits
  --------           --------    ------
  cpu                750m (18%)  0 (0%)
  memory             140Mi (7%)  340Mi (17%)
  ephemeral-storage  0 (0%)      0 (0%)
  hugepages-1Gi      0 (0%)      0 (0%)
  hugepages-2Mi      0 (0%)      0 (0%)
</code></pre><p>You should be able to compare these to the resources you requested to determine why your request was not met, and choose where to <a href=#solution-a>autoscale</a> or <a href=#solution-b>provision a larger node</a> accordingly.</p><p><a href=#solution-a>Link to Solution A</a></p><h2 id=solutions-list>Solutions List</h2><p>A) <a href=#solution-a>Set up autoscaling</a></p><p>B) <a href=#solution-b>Provision appropriately-sized nodes</a></p><h2 id=solutions-detail>Solutions Detail</h2><h3 id=solution-a>A) Set up autoscaling</h3><p>The details of this will vary depending on your platform, but in general the principle is that you have legitimately used up all your resources, and you need more nodes to take the load.</p><p>Note this solution will not work if:</p><ul><li><p>Your nodes are unavailable for other reasons (such as: you have a &lsquo;runaway&rsquo; workload that is consuming all the resources it finds), as you will see this error again once the new resources are consumed.</p></li><li><p>Your workload cannot fit on any node in the cluster</p></li></ul><p>Some potentially useful links to achieving this:</p><ul><li><a href=https://kubernetes.io/blog/2016/07/autoscaling-in-kubernetes/>K8s autoscaling</a></li><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/autoscaling.html>EKS</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-autoscaler>GKE</a></li><li><a href=https://azure.microsoft.com/en-gb/updates/generally-available-aks-cluster-autoscaler/>AKS</a></li></ul><h3 id=solution-a>B) Provision appropriately-sized nodes</h3><p>The details of this will vary according to your platform. You will need to add a node (or set of nodes) that exceeds in size the amount your workload is requesting.</p><p>Also note: your workload scheduler may &lsquo;actively&rsquo; or &lsquo;intelligently&rsquo; move workloads to make them all &lsquo;fit&rsquo; onto the given nodes. In these cases, you may need to significantly over-provision node sizes to reliably accommodate your workload.</p><h2 id=check-resolution>Check Resolution</h2><p>If the error is no longer seen in the workload description in Kubernetes, then this particular issue has been resolved.</p><h2 id=further-information>Further Information</h2><p>When you make a request for Kubernetes to run your workload, it tries to find all the nodes that can fulfil the requirements.</p><p><a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/>Kubernetes resource management docs</a></p><h2 id=owner>Owner</h2><p>email</p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//runbooks.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>0/1 nodes available: insufficient cpu, insufficient memory</b><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#initial-steps-overview>Initial Steps Overview</a></li><li><a href=#detailed-steps>Detailed Steps</a><ul><li><a href=#step-1>1) Determine requested resources</a></li><li><a href=#step-2>2) Have you requested too many resources?</a></li></ul></li><li><a href=#solutions-list>Solutions List</a></li><li><a href=#solutions-detail>Solutions Detail</a><ul><li><a href=#solution-a>A) Set up autoscaling</a></li><li><a href=#solution-a>B) Provision appropriately-sized nodes</a></li></ul></li><li><a href=#check-resolution>Check Resolution</a></li><li><a href=#further-information>Further Information</a></li><li><a href=#owner>Owner</a></li></ul></nav></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><div class="container-lg bg-white h-50">&nbsp;</div><div class=footer-container-wrapper><div class=footer-image><a href=https://container-solutions.com><img src=https://containersolutions.github.io/runbooks/images/logo-main.svg class=hs-image-widget style=width:120px;border-width:0;border:0 width=120 alt=logo-main title=logo-main></a></div><div>Runbooks is sponsored by <a href=https://container-solutions.com>Container Solutions</a>. We bring culture, strategy, and technology together<br>&mdash;to make sure your Cloud Native migration is done right. <a href=https://www.container-solutions.com>See how we can help</a></div></div><div class="bg-white h-10"><div class="text-small text-gray credits">Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</div></div></body></html>