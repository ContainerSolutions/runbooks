<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WWDBK5SV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-N2WWDBK5SV')</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pod In CrashLoopBackOff State &ndash; Runbooks</title><meta name=description property="og:description" content="Pod In CrashLoopBackOff State|"><meta name=apple-mobile-web-app-title content="Runbooks"><link rel=stylesheet href=/runbooks/assets/syntax.css><link rel=stylesheet href=/runbooks/assets/primer-build.css><link rel=stylesheet href=/runbooks/assets/style.css><link rel=stylesheet href=https://containersolutions.github.io/runbooks/custom_style.899dd13784115b34654e51c818307a0a.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://containersolutions.github.io/runbooks/>Runbooks</a><div class="pseudo-menu-item text-gray"><div class=pseudo-flex-item><span class=pseudo-nav-item><a href=https://github.com/containersolutions/runbooks/edit/master/content/posts/kubernetes/crashloopbackoff.md class=edit-link><svg aria-hidden="true" height="16" role="img" viewBox="0 0 14 16" width="14" class="pencil"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996.0 011.41.0l1.59 1.59c.39.39.39 1.02.0 1.41z"/></svg>&nbsp;
Improve this page</a></span></div></div><div class=UnderlineNav-body><div class="flex-column position-relative dropdown"><span class=UnderlineNav-item>Nav Menu</span><div class="Box Box--condensed position-absolute dropdown-content"><div class=Box-body><a href=/runbooks/>Home</a></div><div class=Box-body><a href=/runbooks/posts/kubernetes/>Kubernetes</a></div><div class=Box-body><a href=/runbooks/posts/linux/>Linux</a></div><div class=Box-body><a href=/runbooks/posts/networking/>Networking</a></div><div class=Box-body><a href=/runbooks/posts/python/>Python</a></div><div class=Box-body><a href=/runbooks/posts/how-to/>How-Tos</a></div><div class=Box-body><a href=/runbooks/posts/golang/>Go</a></div></div></div></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">Pod In CrashLoopBackOff State</div></div><div class=Subhead-description><div class=float-md-right><span title="Lastmod: 2023-01-26. Published at: 0001-01-01.">Lastmod: 2023-01-26</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><h2 id=overview>Overview</h2><p>A <code>CrashLoopBackOff</code> error occurs when a pod startup fails repeatedly in Kubernetes.</p><h2 id=check-runbook-match>Check RunBook Match</h2><p>When running a <code>kubectl get pods</code> command, you will see a line like this in the output for your pod:</p><pre><code>NAME                     READY     STATUS             RESTARTS   AGE
nginx-7ef9efa7cd-qasd2   0/1       CrashLoopBackOff   2          1m
</code></pre><p>If you see something like:</p><pre><code>NAME                     READY     STATUS                  RESTARTS   AGE
pod1-7ef9efa7cd-qasd2    0/2       Init:CrashLoopBackOff   2          1m
</code></pre><p>then continue with this runbook, bearing in mind that the problem is likely specific to the init container.</p><h2 id=initial-steps-overview>Initial Steps Overview</h2><ol><li><p><a href=#step-1>Gather information</a></p></li><li><p><a href=#step-2>Examine <code>Events</code> section in describe output</a></p></li><li><p><a href=#step-3>Check the exit code</a></p></li><li><p><a href=#step-4>Check readiness/liveness probes</a></p></li><li><p><a href=#step-5>Check common application issues</a></p></li></ol><h2 id=detailed-steps>Detailed Steps</h2><h3 id=step-1>1) Gather information</h3><p>Run these commands to gather relevant information in one step:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe -n <span style=color:#f92672>[</span>NAMESPACE_NAME<span style=color:#f92672>]</span> pod <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span> &gt; /tmp/runbooks_describe_pod.txt
kubectl logs --all-containers -n <span style=color:#f92672>[</span>NAMESPACE_NAME<span style=color:#f92672>]</span> &gt; /tmp/runbooks_pod_logs.txt
kubectl logs --all-containers --previous -n <span style=color:#f92672>[</span>NAMESPACE_NAME<span style=color:#f92672>]</span> &gt; /tmp/runbooks_previous_pod_logs.txt
</code></pre></div><h3 id=step-2>2) Examine <code>Events</code> section in output</h3><p>Look at the <code>Events</code> section of your <code>/tmp/runbooks_describe_pod.txt</code> file.</p><h4 id=21-back-off-restarting-failed-container>2.1) <code>Back-off restarting failed container</code></h4><p>If you see a warning like the following in your <code>/tmp/runbooks_describe_pod.txt</code> output:</p><pre><code>Warning  BackOff    8s (x2 over 9s)    kubelet, dali      Back-off restarting failed container
</code></pre><p>then the pod has repeatedly failed to start up successfully.</p><p>Make a note of any containers that have a <code>State</code> of <code>Waiting</code> in the description and a description of <code>CrashLoopBackOff</code>. These are the containers you will need to fix.</p><h3 id=step-3>3) Check the exit code</h3><p>Examine the describe output, and look for the Exit Code.</p><h4 id=31-exit-code-0>3.1) Exit Code 0</h4><p>This exit code implies that the specified container command completed &lsquo;sucessfully&rsquo;, but too often for Kubernetes to accept as working.</p><p>Did you fail to specify a command the pod spec, and the container ran (for example) a default shell command that failed? If so, you will need to add the right command. See <a href=#solution-c>solution c</a>.</p><p>Examine the logs in <code>/tmp/runbooks_describe_pod.txt</code> to see whether there are any clues there as to why the application terminated.</p><h4 id=31-exit-code-1>3.1) Exit Code 1</h4><p>The container failed to run its command successfully, and returned an exit code of 1. This is an application failure within the process that was started, but return with a failing exit code some time after.</p><p>If this is happening only with all pods running on your cluster, then there may be a problem with your notes. Check nodes are OK on your cluster with: <code>kubectl get nodes -o wide</code>.</p><p>Examine the logs in <code>/tmp/runbooks_describe_pod.txt</code> and determine resolution in the context of the command that ran as specified in the image, or debug the application directly.</p><h4 id=32-exit-code-2>3.2) Exit Code 2</h4><p>An exit code of <code>2</code> indicates either that the application chose to return that error code, or (by convention) there was a <code>misuse of a shell builtin</code>. Check your pod&rsquo;s command specification to ensure that the command is correct. If you think it is correct, try running the image locally with a shell and run the command directly.</p><h4 id=32-exit-code-128>3.2) Exit Code 128</h4><p>An exit code of <code>128</code> indicates that the container could not run. Check this by examining the <code>/tmp/runbooks_describe_pod.txt</code> output to see whether the <code>LastState</code> <code>Reason</code> is: <code>ContainerCannotRun</code>.</p><h4 id=33-exit-code-137>3.3) Exit Code 137</h4><p>This indicates that the container was killed with signal 9</p><p>This can be due to one of the following reasons:</p><h5 id=331-container-ran-out-of-memory>3.3.1) Container ran out of memory</h5><p>This may be because your application needs more resources than it&rsquo;s allowed to use, or your application is using more than it should. Which of these is the case is context-specific, so you will need to use your judgement.</p><p>If you want to increase your pod&rsquo;s resource request, see <a href=#solution-e>solution E</a>.</p><h5 id=332-the-oomkiller-killed-the-container>3.3.2) The OOMKiller killed the container</h5><p>You will also likely see <code>Reason: OOM</code> in the container in the <code>/tmp/runbooks_describe_pod.txt</code> output.</p><h5 id=333-the-liveness-probe-failed>3.3.3) The liveness probe failed</h5><p>If you see a warning like this in the Events output of <code>/tmp/runbooks_describe_pod.txt</code>:</p><pre><code>Warning  Unhealthy  13s (x3 over 23s)  kubelet, dali      Liveness probe failed: cat: can't open '/tmp/healthy': No such file or directory
</code></pre><p>Then you will need to check your liveness probes. Skip to <a href=#step-4>step 4</a>.</p><h3 id=step-4>4) Check liveness/readiness probes</h3><p>If these are too short for the application initialization time, then Kubernetes may be killing the application too early.</p><p>Whether the time taken to start is longer because there is a problem, or whether the time take to start is genuinely longer than the probe times is a judgement for the reader/application owner.</p><p>If the probe times are too short, see Solution D) below.</p><p>See <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/>here</a> for more background information.</p><h3 id=step-5>5) Check common application issues</h3><p>Some common application problems to consider that may not be specific to your context:</p><ul><li><p>If your application requires privileged access to function, then you may need to set <code>allowPrivilegeEscalation</code> (some core components rely on this, eg coreDNS)</p></li><li><p>SELinux or AppArmor controls may be preventing your application from running</p></li></ul><p>Note that by allowing privilege escalation, you may be undermining necessary controls, or allowing your application to do something that is not allowed in your context.</p><h2 id=solutions-list>Solutions List</h2><p>A) <a href=#solution-a>Fix the application</a></p><p>B) <a href=#solution-b>Add a startup command</a></p><p>C) <a href=#solution-c>Correct the container or spec to run a command that exists in the container, and is executable</a></p><p>D) <a href=#solution-d>Adjust the time for the liveness/readiness probes</a></p><p>E) <a href=#solution-e>Increase resource request</a></p><h2 id=solutions-detail>Solutions Detail</h2><h3 id=solution-a>A) Fix the application</h3><p>This is outside the scope of this runbook.</p><h3 id=solution-b>B) Add a startup command</h3><p>In order for a pod to start, it needs a startup command. Consider adding one to the container image, or adding a command to the container specification(s) within the pod.</p><h3 id=solution-c>C) Correct the container or spec to run a command that exists in the container</h3><p>If the command was not specified (both in the image and the pod specification), then add a command in either place.</p><p>If the command was not executable, make it executable. This may require a change to the container build, or specifying a correct executable.</p><h3 id=solution-d>D) Adjust the time for the liveness/readiness probes</h3><p>See <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes>here</a> for information on how and what to change in your pod specification.</p><h3 id=solution-e>E) Increase resource request</h3><p>If you want to increase the resources allocated to your pod, see <a href=https://kubernetes.io/docs/tasks/configure-pod-container/>here</a>.</p><h2 id=check-resolution>Check Resolution</h2><p>If the pod starts up with status <code>RUNNING</code> according to the output of <code>kubectl get pods</code>, then the issue has been resolved.</p><p>If there is a different status, then it may be that this particular issue is resolved, but a new issue has been revealed, and the runbook needs to be re-followed.</p><p>If it has not been resolved by this runbook, then please comment below.</p><h2 id=further-steps>Further Steps</h2><p>None</p><h2 id=further-information>Further Information</h2><p><a href=https://kubernetes.io/docs/concepts/workloads/pods/init-containers/>Init containers</a></p><p><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes>Probes</a></p><p><a href=https://kubernetes.io/docs/tasks/debug-application-cluster/debug-cluster/#looking-at-logs>Kubelet logs</a></p><h2 id=owner>Owner</h2><p><a href=https://github.com/ianmiell>Ian Miell</a></p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//runbooks.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>Pod In CrashLoopBackOff State</b><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#check-runbook-match>Check RunBook Match</a></li><li><a href=#initial-steps-overview>Initial Steps Overview</a></li><li><a href=#detailed-steps>Detailed Steps</a><ul><li><a href=#step-1>1) Gather information</a></li><li><a href=#step-2>2) Examine <code>Events</code> section in output</a></li><li><a href=#step-3>3) Check the exit code</a></li><li><a href=#step-4>4) Check liveness/readiness probes</a></li><li><a href=#step-5>5) Check common application issues</a></li></ul></li><li><a href=#solutions-list>Solutions List</a></li><li><a href=#solutions-detail>Solutions Detail</a><ul><li><a href=#solution-a>A) Fix the application</a></li><li><a href=#solution-b>B) Add a startup command</a></li><li><a href=#solution-c>C) Correct the container or spec to run a command that exists in the container</a></li><li><a href=#solution-d>D) Adjust the time for the liveness/readiness probes</a></li><li><a href=#solution-e>E) Increase resource request</a></li></ul></li><li><a href=#check-resolution>Check Resolution</a></li><li><a href=#further-steps>Further Steps</a></li><li><a href=#further-information>Further Information</a></li><li><a href=#owner>Owner</a></li></ul></nav></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><div class="container-lg bg-white h-50">&nbsp;</div><div class=footer-container-wrapper><div class=footer-image><a href=https://container-solutions.com><img src=https://containersolutions.github.io/runbooks/images/logo-main.svg class=hs-image-widget style=width:120px;border-width:0;border:0 width=120 alt=logo-main title=logo-main></a></div><div>Runbooks is sponsored by <a href=https://container-solutions.com>Container Solutions</a>. We bring culture, strategy, and technology together<br>&mdash;to make sure your Cloud Native migration is done right. <a href=https://www.container-solutions.com>See how we can help</a></div></div><div class="bg-white h-10"><div class="text-small text-gray credits">Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</div></div></body></html>