<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WWDBK5SV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-N2WWDBK5SV')</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pod In OutOfPods State &ndash; Runbooks</title><meta name=description property="og:description" content="Pod In OutOfPods State|"><meta name=apple-mobile-web-app-title content="Runbooks"><link rel=stylesheet href=/runbooks/assets/syntax.css><link rel=stylesheet href=/runbooks/assets/primer-build.css><link rel=stylesheet href=/runbooks/assets/style.css><link rel=stylesheet href=https://containersolutions.github.io/runbooks/custom_style.899dd13784115b34654e51c818307a0a.css></head><body class=bg-gray><div id=holy class="container-lg bg-white h-100"><div id=header class="px-1 bg-white"><nav class="UnderlineNav UnderlineNav--right px-2"><a class="UnderlineNav-actions muted-link h2" href=https://containersolutions.github.io/runbooks/>Runbooks</a><div class="pseudo-menu-item text-gray"><div class=pseudo-flex-item><span class=pseudo-nav-item><a href=https://github.com/containersolutions/runbooks/edit/master/content/posts/kubernetes/outofpods.md class=edit-link><svg aria-hidden="true" height="16" role="img" viewBox="0 0 14 16" width="14" class="pencil"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996.0 011.41.0l1.59 1.59c.39.39.39 1.02.0 1.41z"/></svg>&nbsp;
Improve this page</a></span></div></div><div class=UnderlineNav-body><div class="flex-column position-relative dropdown"><span class=UnderlineNav-item>Nav Menu</span><div class="Box Box--condensed position-absolute dropdown-content"><div class=Box-body><a href=/runbooks/>Home</a></div><div class=Box-body><a href=/runbooks/posts/kubernetes/>Kubernetes</a></div><div class=Box-body><a href=/runbooks/posts/linux/>Linux</a></div><div class=Box-body><a href=/runbooks/posts/networking/>Networking</a></div><div class=Box-body><a href=/runbooks/posts/python/>Python</a></div><div class=Box-body><a href=/runbooks/posts/how-to/>How-Tos</a></div><div class=Box-body><a href=/runbooks/posts/golang/>Go</a></div></div></div></div></nav></div><div role=main id=main class="holy-main markdown-body px-4 bg-white"><div class=Subhead><div class=Subhead-heading><div class="h1 mt-3 mb-1">Pod In OutOfPods State</div></div><div class=Subhead-description><div class=float-md-right><span title="Lastmod: 2023-01-26. Published at: 0001-01-01.">Lastmod: 2023-01-26</span></div></div></div><article><section class="pb-6 mb-3 border-bottom"><h2 id=overview>Overview</h2><p>An <code>OutOfPods</code> error occurs when a pod has been scheduled to a node but that node does not have enough resources to run that pod.</p><h2 id=check-runbook-match>Check RunBook Match</h2><p>When running a <code>kubectl get pods</code> command, you will see a line like this in the output for your pod:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>NAME                     READY     STATUS             RESTARTS   AGE
nginx-7ef9efa7cd-qasd2   0/1       OutOfpods          0          1m
</code></pre></div><h2 id=initial-steps-overview>Initial Steps Overview</h2><ol><li><p><a href=#step-1>Gather information</a></p></li><li><p><a href=#step-2>Examine <code>Events</code> section in describe output</a></p></li><li><p><a href=#step-3>Check the error message</a></p></li></ol><h2 id=detailed-steps>Detailed Steps</h2><h3 id=step-1>1) Gather information</h3><p>Run this commands to gather relevant information in one step:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe -n <span style=color:#f92672>[</span>NAMESPACE_NAME<span style=color:#f92672>]</span> pod <span style=color:#f92672>[</span>POD_NAME<span style=color:#f92672>]</span><span style=color:#e6db74>`</span> &gt; /tmp/runbooks_describe_pod.txt
</code></pre></div><h3 id=step-2>2) Examine <code>Events</code> section in describe output</h3><h4 id=21-node-didnt-have-enough-resource>2.1) Node didn&rsquo;t have enough resource</h4><p>If you see lines that look like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Type     Reason     Age   From     Message
----     ------     ----  ----     -------
Warning  OutOfpods  108s  kubelet  Node didn&#39;t have enough resource: pods, requested: 1, used: 10, capacity: 10
</code></pre></div><p>This warning indicates that the node does not have enough resources to run the pod. In this case kubelet maximum pod capacity has been reached.</p><h2 id=solutions-list>Solutions List</h2><p>A) <a href=#solution-a>Increase the kubelet maxPods</a></p><h2 id=solutions-detail>Solutions Detail</h2><h3 id=solution-a>A) Increase the kubelet maxPods</h3><p>Kubelet has a 110 pods default value for the maxPods attribute. This means that each kubelet can run up to 110 pods.</p><p>To change the default value you need administration permission on the cluster. To do so, it is required to verify if the kubelet service has a KubeletConfiguration specified. To find that out you can execute the following command on the same node as the pod has been scheduled:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl show kubelet | grep -e <span style=color:#e6db74>&#34;--config&#34;</span>
</code></pre></div><p>If the config file exists, the KubeletConfiguration file will be the one specified by the <code>--config</code> argument. It is possible that the property <code>maxPods</code> is not present on the file, you can append it to the yaml file with the value of your preference like this example shows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubelet.config.k8s.io/v1beta1</span>
<span style=color:#f92672>authentication</span>:
  <span style=color:#f92672>anonymous</span>:
    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#f92672>webhook</span>:
    <span style=color:#f92672>cacheTTL</span>: <span style=color:#ae81ff>0s</span>
    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>x509</span>:
    <span style=color:#f92672>clientCAFile</span>: <span style=color:#ae81ff>/etc/kubernetes/pki/ca.crt</span>
[<span style=color:#ae81ff>...]</span>
<span style=color:#f92672>syncFrequency</span>: <span style=color:#ae81ff>0s</span>
<span style=color:#f92672>volumeStatsAggPeriod</span>: <span style=color:#ae81ff>0s</span>
<span style=color:#f92672>maxPods</span>: <span style=color:#ae81ff>120</span>
</code></pre></div><p>For clusters created using kubeadm, the kubelet configuration is marshalled to disk at <code>/var/lib/kubelet/config.yaml</code> and then copied to <code>kube-system/kubelet-config</code> ConfigMap.</p><p>On the other hand, if the file is missing, you can create a KubeletConfiguration file. An example to change the <code>maxPods</code> property could be:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubelet.config.k8s.io/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KubeletConfiguration</span>
<span style=color:#f92672>maxPods</span>: <span style=color:#ae81ff>120</span>
</code></pre></div><p>Save this file to a well known location, for example <code>/var/lib/kubelet/config.yaml</code>. Then update the kubelet service to add the following environment variable:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml
</code></pre></div><p>Reload the systemctl daemon and then restart the kubelet service to get the configuration applied.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl daemon-reload
systemctl restart kubelet
</code></pre></div><h2 id=check-resolution>Check Resolution</h2><p>If the pod starts up with status <code>RUNNING</code> according to the output of <code>kubectl get pods</code>, then the issue has been resolved.</p><p>If there is a different status, then it may be that this issue is resolved, but a new issue has been revealed.</p><h2 id=further-steps>Further Steps</h2><p>None</p><h2 id=further-information>Further Information</h2><p><a href=https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/>Kubelet configuration file</a></p><p><a href=https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration>KubeletConfiguration specification</a></p><p>Some cloud providers allow you to define the maximum number of pods at Kubernetes cluster creation. Usually this comes related to the CNI plugin you choose, as some of the implementations can have restrictions related with networking and IP addresses allocation. We encourage you to read specific cloud provider documentation if you are experiencing this issue or plan to migrate to a cloud service to tackle this problem:</p><ul><li><a href=https://learn.microsoft.com/en-us/azure/aks/configure-azure-cni>Configure Azure CNI networking in Azure Kubernetes Service (AKS)</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr>Configfure maximum Pods per node in GKE</a></li><li><a href=https://docs.aws.amazon.com/eks/latest/userguide/cni-custom-network.html>EKS CNI custom network</a> and <a href=https://docs.aws.amazon.com/eks/latest/userguide/cni-increase-ip-addresses.html>EKS CNI increase the available IP addresses</a></li></ul><h2 id=owner>Owner</h2><p><a href=https://github.com/carvido1>Carlos Vicent Domenech</a></p></section><section><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//runbooks.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></article></div><div id=side class="pr-1 bg-white"><aside class=pr-3><div id=toc class="Box Box--blue mb-3"><b>Pod In OutOfPods State</b><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#check-runbook-match>Check RunBook Match</a></li><li><a href=#initial-steps-overview>Initial Steps Overview</a></li><li><a href=#detailed-steps>Detailed Steps</a><ul><li><a href=#step-1>1) Gather information</a></li><li><a href=#step-2>2) Examine <code>Events</code> section in describe output</a></li></ul></li><li><a href=#solutions-list>Solutions List</a></li><li><a href=#solutions-detail>Solutions Detail</a><ul><li><a href=#solution-a>A) Increase the kubelet maxPods</a></li></ul></li><li><a href=#check-resolution>Check Resolution</a></li><li><a href=#further-steps>Further Steps</a></li><li><a href=#further-information>Further Information</a></li><li><a href=#owner>Owner</a></li></ul></nav></div><div></div></aside></div><div id=footer class="pt-2 pb-3 bg-white text-center"></div></div><div class="container-lg bg-white h-50">&nbsp;</div><div class=footer-container-wrapper><div class=footer-image><a href=https://container-solutions.com><img src=https://containersolutions.github.io/runbooks/images/logo-main.svg class=hs-image-widget style=width:120px;border-width:0;border:0 width=120 alt=logo-main title=logo-main></a></div><div>Runbooks is sponsored by <a href=https://container-solutions.com>Container Solutions</a>. We bring culture, strategy, and technology together<br>&mdash;to make sure your Cloud Native migration is done right. <a href=https://www.container-solutions.com>See how we can help</a></div></div><div class="bg-white h-10"><div class="text-small text-gray credits">Powered by the
<a href=https://github.com/qqhann/hugo-primer class=link-gray-dark>Hugo-Primer</a> theme for
<a href=https://gohugo.io class=link-gray-dark>Hugo</a>.</div></div></body></html>